const { createClient } = require('@supabase/supabase-js')
require('dotenv').config({ path: '.env.local' })

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY
)

// Extract exact content from the current /people-partners page
// This represents the master content that should be in the CMS
const peoplePartnersPageMasterContent = {
  page: {
    slug: 'people-partners',
    title: 'People - Partner Network',
    description: 'Scale Your Execution with a Trusted Ecosystem of Specialized Firms - For large-scale initiatives, leverage our Partner Networkâ€”a curated ecosystem of specialized consulting firms and agencies that bring deep domain expertise and a full team of resources to solve your most complex challenges.',
    meta_title: 'Elevation AI Partner Network - Trusted Consulting Firms for Large-Scale Initiatives',
    meta_description: 'Scale your execution with our Partner Network of specialized consulting firms and agencies. Expert guidance for large-scale digital transformation, post-merger integration, and strategic initiatives.',
    is_published: true,
    created_by: process.env.ADMIN_USER_ID || null
  },
  sections: [
    {
      section_type: 'hero_simple',
      order_index: 1,
      title: 'Hero Section',
      section_data: {
        title: 'Scale Your Execution with a Trusted Ecosystem of Specialized Firms',
        description: 'For large-scale initiatives, leverage our Partner Networkâ€”a curated ecosystem of specialized consulting firms and agencies that bring deep domain expertise and a full team of resources to solve your most complex challenges.',
        ctaButtons: [
          {
            text: 'Learn More',
            href: '#challenge-solution',
            variant: 'default'
          },
          {
            text: 'Meet Our Partners',
            href: '/website/demo',
            variant: 'outline'
          }
        ],
        logoImage: '/images/branding/E-AI-Squircle.svg'
      },
      is_published: true
    },
    {
      section_type: 'problem_cards',
      order_index: 2,
      title: 'Challenge and Solution',
      section_data: {
        challenge: {
          badgeText: 'The Challenge',
          title: 'The Disconnect of Traditional Consulting',
          statement: 'Large-scale projects often require the horsepower of a dedicated consulting firm. However, traditional engagements can be disjointed. External firms often work in their own systems, leading to siloed communication, a painful knowledge transfer process at the end of the project, and a lack of real integration with your team.'
        },
        solution: {
          badgeText: 'Our Solution: A Natively Integrated Partnership',
          subtitle: 'A New Model for Consulting Engagement',
          description: 'Our Partner Network consists of leading, highly specialized consulting firms who are experts on the Elevation AI platform. This creates a fundamentally better engagement model, providing a level of integrated expertise that a single expert cannot offer.',
          processSteps: [
            {
              title: 'A Unified Workspace',
              description: 'Instead of working in separate systems, our partners embed directly into your Elevation AI Workspaces. This creates a single, shared environment for all communication, deliverables, and project management, providing you with unprecedented transparency.',
              icon: 'building-2-line'
            },
            {
              title: 'No Lost Knowledge',
              description: 'Because the entire engagement happens on your platform, all of the work product, research, and strategic insights generated by the consulting team are automatically captured in your private Knowledge Base. When the project ends, the knowledge stays with you.',
              icon: 'shield-check-line'
            },
            {
              title: 'Accelerated Execution',
              description: 'Our partners leverage our platform\'s library of pre-built agents and workflows to deliver results faster. They spend less time on manual data gathering and more time on high-value strategic work, resulting in a more efficient and impactful engagement.',
              icon: 'zap-line'
            }
          ]
        }
      },
      is_published: true
    },
    {
      section_type: 'approach_cards',
      order_index: 3,
      title: 'Who This Is For',
      section_data: {
        badgeText: 'Who This Is For',
        title: 'Strategic Horsepower for Your Biggest Initiatives',
        description: 'Our Partner Network is ideal for organizations undertaking:',
        logoImage: '/images/branding/E-AI-Sqaure.svg',
        characteristics: [
          {
            number: '1',
            title: 'Large-Scale Transformation',
            description: 'Large-scale digital or agentic transformation projects.'
          },
          {
            number: '2',
            title: 'Post-Merger Integration',
            description: 'Post-merger integration for a newly acquired company.'
          },
          {
            number: '3',
            title: 'New Market Entry',
            description: 'The rollout of a new product or entry into a new market.'
          },
          {
            number: '4',
            title: 'Operational Overhaul',
            description: 'A comprehensive operational overhaul to prepare for an exit.'
          }
        ]
      },
      is_published: true
    },
    {
      section_type: 'solutions_carousel',
      order_index: 4,
      title: 'Partner Network',
      section_data: {
        badgeText: 'Partner Network',
        title: 'Trusted Consulting Partners',
        description: 'Our Partner Network consists of leading consulting firms and agencies that are experts on the Elevation AI platform, bringing deep domain expertise and full team resources to solve your most complex challenges.',
        backgroundColor: 'bg-green-500/10 dark:bg-green-500/15',
        partnerCategories: [
          {
            id: 'digital-transformation',
            title: 'Digital Transformation',
            description: 'Strategic guidance on large-scale digital transformation initiatives and change management.',
            icon: 'building-2-line',
            specialties: ['Strategy', 'Change Management', 'Implementation', 'ROI Analysis']
          },
          {
            id: 'merger-integration',
            title: 'Merger & Integration',
            description: 'Expert support for post-merger integration and organizational restructuring.',
            icon: 'shield-check-line',
            specialties: ['Integration Planning', 'Due Diligence', 'Cultural Alignment', 'System Integration']
          },
          {
            id: 'market-expansion',
            title: 'Market Expansion',
            description: 'Strategic support for new market entry and product rollout initiatives.',
            icon: 'global-line',
            specialties: ['Market Research', 'Go-to-Market', 'Partnership Development', 'Launch Strategy']
          },
          {
            id: 'exit-preparation',
            title: 'Exit Preparation',
            description: 'Comprehensive operational overhaul and preparation for successful exits.',
            icon: 'handshake-line',
            specialties: ['Operational Excellence', 'Financial Optimization', 'Due Diligence Prep', 'Value Maximization']
          }
        ],
        carouselSettings: {
          autoPlay: true,
          autoPlayInterval: 5000,
          showProgressIndicators: true,
          cardWidth: 320,
          cardGap: 24,
          highlightActiveCard: true,
          naturalScroll: false,
          flexibleWidth: true
        }
      },
      is_published: true
    },
    {
      section_type: 'logo_carousel',
      order_index: 5,
      title: 'Logo Carousel',
      section_data: {
        title: 'Led by industry veterans from:',
        backgroundColor: 'bg-muted/20'
      },
      is_published: true
    },
    {
      section_type: 'cta',
      order_index: 6,
      title: 'Call to Action',
      section_data: {
        title: 'Find the Right Partner for Your Next Big Move',
        description: 'Discover our ecosystem of trusted consulting firms and agencies.',
        backgroundColor: 'bg-muted/30',
        ctaButtons: [
          {
            text: 'Meet Our Partners',
            href: '/website/demo',
            variant: 'default'
          },
          {
            text: 'About Us',
            href: '/website/about',
            variant: 'outline'
          }
        ]
      },
      is_published: true
    }
  ]
}

async function syncPeoplePartnersToCMS() {
  console.log('ğŸ“‹ This will make the current people partners page content the master source for the CMS')
  
  try {
    // Get or create the people-partners page
    let { data: page, error: pageError } = await supabase
      .from('pages')
      .select('*')
      .eq('slug', 'people-partners')
      .single()

    if (pageError && pageError.code !== 'PGRST116') {
      throw pageError
    }

    if (!page) {
      // Create new page
      const { data: newPage, error: createError } = await supabase
        .from('pages')
        .insert(peoplePartnersPageMasterContent.page)
        .select()
        .single()

      if (createError) throw createError
      page = newPage
      console.log('ğŸ“„ Created new People Partners page in CMS')
    } else {
      // Update existing page
      const { error: updateError } = await supabase
        .from('pages')
        .update(peoplePartnersPageMasterContent.page)
        .eq('id', page.id)

      if (updateError) throw updateError
      console.log('ğŸ“„ Updated existing People Partners page in CMS')
    }

    // Clear existing sections
    const { error: deleteError } = await supabase
      .from('page_sections')
      .delete()
      .eq('page_id', page.id)

    if (deleteError) throw deleteError
    console.log('ğŸ—‘ï¸ Cleared existing sections')

    // Create new sections with exact content from current people-partners page
    const sectionsToInsert = peoplePartnersPageMasterContent.sections.map(section => ({
      page_id: page.id,
      section_type: section.section_type,
      section_order: section.order_index,
      title: section.title,
      section_data: section.section_data,
      is_published: section.is_published
    }))

    const { data: insertedSections, error: insertError } = await supabase
      .from('page_sections')
      .insert(sectionsToInsert)
      .select()

    if (insertError) throw insertError

    console.log('âœ… People Partners page content successfully synced to CMS!')
    console.log(`ğŸ“Š Created ${insertedSections.length} sections in CMS`)
    console.log('ğŸ¯ The current /people-partners page content is now the master source in the CMS')
    console.log('âš™ï¸ You can now edit this content through: /admin/pages')
    console.log('ğŸŒ View the page at: /website/people-partners')

  } catch (error) {
    console.error('âŒ Error syncing people partners page to CMS:', error)
    process.exit(1)
  }
}

// Run the sync
syncPeoplePartnersToCMS()
